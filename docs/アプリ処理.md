flowchart TD
    A[ユーザー: Webページにアクセス] --> B[ファイルアップロード]
    
    subgraph サーバー処理
        C[1. ファイル受信・検証]
        D[2. OCR処理]
        E[3. データ抽出]
        F[4. Excel生成]
    end
    
    subgraph エラーハンドリング
        V[ファイル形式チェック]
        W[OCRエラーチェック]
        X[必須項目チェック]
        Y[Excel生成エラーチェック]
    end
    
    B --> C
    C --> V
    V -->|OK| D
    V -->|NG| Z[エラーメッセージ表示]
    
    D --> W
    W -->|OK| E
    W -->|NG| Z
    
    E --> X
    X -->|OK| F
    X -->|NG| Z
    
    F --> Y
    Y -->|OK| G[5. 結果表示]
    Y -->|NG| Z
    
    G --> H[ユーザー: Excelダウンロード]
    Z --> A

    style サーバー処理 fill:#f9f,stroke:#333,stroke-width:2px
    style エラーハンドリング fill:#ff9,stroke:#333,stroke-width:2px
```

### 処理フローの説明

1. **ファイル受信・検証**
   - アップロードされたファイルの存在確認
   - ファイル形式の検証（画像またはPDF）
   - 一時ファイルとして保存

2. **OCR処理**
   - 画像の前処理（グレースケール変換等）
   - テキスト抽出
   - OCR結果の検証

3. **データ抽出**
   - OCRテキストから各項目を抽出
   - 必須項目（発行日、発行者、金額）の存在確認
   - データの正規化

4. **Excel生成**
   - 抽出データのExcelフォーマット変換
   - ファイル生成

5. **結果表示**
   - 処理結果の表示
   - Excelファイルのダウンロードリンク提供
   - 一時ファイルの削除

### エラーハンドリング
- 各ステップでのエラーチェック
- 具体的なエラーメッセージの表示
- エラー発生時のユーザーへのフィードバック
- 一時ファイルの確実な削除